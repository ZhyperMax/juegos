<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Adivina Colores Online</title>
    <link rel="stylesheet" href="juego.css" />
    <link rel="icon" href="img/icon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Información del usuario -->
<div id="userDisplay" style="display: none;" class="user-info">
    <span>Usuario: <strong id="currentUserName"></strong></span>
    <button onclick="cerrarSesion()" class="logout-btn">Cerrar Sesión</button>
</div>

<div class="logo-container">
    <img src="img/logo.png" alt="Logo" class="logo" />
    <button id="infoBtn" class="btn-info" onclick="mostrarInfoJuego()">
        <span class="info-icon">ℹ️</span>
        <span class="info-text">Info del Juego</span>
    </button>
    <button id="rankingBtn" class="btn-ranking" onclick="mostrarRanking()">
        <span class="ranking-icon">🏆</span>
        <span class="ranking-text">Ranking</span>
    </button>
</div>

<div class="app-container">
  <div id="formulario">
    <div id="formularioCrear" class="formulario">
      <h3>Crear Sala</h3>
      <label>
        <input type="radio" name="modoJuego" value="solo" checked> Solo
      </label>
      <label>
        <input type="radio" name="modoJuego" value="dos"> Multijugador
      </label>
      <button onclick="crearSala()">Crear Sala</button>
    </div>

    <div id="formularioUnir" class="formulario">
      <h3>Unirse a Sala</h3>
      <input type="text" id="codigoUnir" placeholder="Código de sala">
      <button onclick="unirseSala()">Unirse</button>
    </div>

    <hr />

    <div id="listaSalas" class="form-section">
      <h2>Salas disponibles</h2>
      <div id="contenedorSalas">Cargando salas...</div>
    </div>

    <p id="estadoApp"></p>
  </div>

    <div id="juego">
        <div class="game-header">
            <h2 class="player-name">Jugador: <span id="jugadorNombre"></span></h2>
            <div class="sala-info">
                <h3>Código de Sala: <span id="codigoSala"></span></h3>
                <button id="compartirSalaBtn" class="btn-compartir" onclick="compartirSala()" style="display: none;">
                    <span class="compartir-icon">🔗</span>
                    <span class="compartir-text">Compartir Sala</span>
                </button>
            </div>
        </div>

        <p class="game-instruction">Seleccioná <b>4 colores</b> para tu intento:</p>
        <div id="coloresDisponibles"></div>
        <button class="btn btn-primary" onclick="enviarIntento()">Enviar intento</button>

        <p class="timer-display">Tiempo restante: <span id="tiempoRestante">20</span> segundos</p>

        <h3 class="historial-title">Historial de intentos:</h3>
        <div id="historial"></div>

        <hr />

        <div id="chat-container">
            <div id="mensajes"></div>
            <div id="chat-input-area">
                <input type="text" id="mensajeInput" placeholder="Escribe un mensaje..." onkeypress="if(event.key==='Enter') enviarMensaje()" />
                <button class="btn btn-secondary" onclick="enviarMensaje()">Enviar</button>
            </div>
        </div>

        <button id="salirBtn" class="btn btn-danger" onclick="salirDeSala()">Salir de la sala</button>
    </div>
</div>

<!-- Modal de Autenticación -->
<div id="authModal" class="modal-overlay modal-auth-overlay">
    <div class="modal-content modal-auth">
        <div class="modal-header">
            <h2>🎮 Bienvenido a Adivina Colores</h2>
        </div>
        
        <div class="modal-body">
            <div class="auth-tabs">
                <button class="tab-btn active" onclick="cambiarPestanaAuth('login')">🔑 Entrar</button>
                <button class="tab-btn" onclick="cambiarPestanaAuth('register')">📝 Registrarse</button>
            </div>
            
            <!-- Tab de Login -->
            <div id="auth-login" class="auth-tab-content active">
                <div class="auth-form">
                    <h3>¡Bienvenido de vuelta!</h3>
                    <div class="form-group">
                        <label for="loginNombre">👤 Nombre de usuario:</label>
                        <input type="text" id="loginNombre" placeholder="Tu nombre de usuario" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label for="loginPin">🔐 PIN:</label>
                        <input type="password" id="loginPin" placeholder="Tu PIN (4 dígitos)" maxlength="4" pattern="[0-9]{4}">
                    </div>
                    <button class="btn btn-primary auth-btn" onclick="iniciarSesion()">🚀 Entrar</button>
                    <p class="auth-help">¿No tienes cuenta? <span onclick="cambiarPestanaAuth('register')" class="link-text">Regístrate aquí</span></p>
                </div>
            </div>
            
            <!-- Tab de Registro -->
            <div id="auth-register" class="auth-tab-content">
                <div class="auth-form">
                    <h3>¡Crea tu cuenta!</h3>
                    <div class="form-group">
                        <label for="registerNombre">👤 Nombre de usuario:</label>
                        <input type="text" id="registerNombre" placeholder="Elige tu nombre único" maxlength="20">
                        <small class="form-help">Este será tu nombre en el ranking</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPin">🔐 PIN:</label>
                        <input type="password" id="registerPin" placeholder="Crea un PIN de 4 dígitos" maxlength="4" pattern="[0-9]{4}">
                        <small class="form-help">Recuerda este PIN para acceder después</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPinConfirm">🔐 Confirmar PIN:</label>
                        <input type="password" id="registerPinConfirm" placeholder="Repite tu PIN" maxlength="4" pattern="[0-9]{4}">
                    </div>
                    <button class="btn btn-success auth-btn" onclick="registrarUsuario()">✨ Crear Cuenta</button>
                    <p class="auth-help">¿Ya tienes cuenta? <span onclick="cambiarPestanaAuth('login')" class="link-text">Inicia sesión aquí</span></p>
                </div>
            </div>
            
            <div id="auth-status" class="auth-status"></div>
        </div>
    </div>
</div>

<!-- Modal de Información del Juego -->
<div id="modalInfo" class="modal-overlay" onclick="cerrarModalInfo()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2>🎨 Adivina Colores Online</h2>
            <button class="modal-close" onclick="cerrarModalInfo()">×</button>
        </div>
        <div class="modal-body">
            <div class="info-section">
                <h3>🎯 Objetivo del Juego</h3>
                <p>Adivinar una secuencia secreta de <strong>4 colores únicos</strong> en máximo <strong>10 intentos</strong>.</p>
            </div>

            <div class="info-section">
                <h3>🎮 Modos de Juego</h3>
                <div class="mode-grid">
                    <div class="mode-card">
                        <h4>🧑‍💻 Modo Solo</h4>
                        <ul>
                            <li>Juego individual contra la máquina</li>
                            <li><strong>15 segundos</strong> por intento</li>
                            <li>El tiempo agotado cuenta como intento perdido</li>
                        </ul>
                    </div>
                    <div class="mode-card">
                        <h4>👥 Modo Multijugador</h4>
                        <ul>
                            <li>Hasta <strong>2 jugadores</strong> por sala</li>
                            <li>Sistema de turnos alternos</li>
                            <li>Chat en tiempo real</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3>🎨 Colores Disponibles</h3>
                <div class="color-showcase">
                    <div class="color-item" style="background-color: red;">Rojo</div>
                    <div class="color-item" style="background-color: blue;">Azul</div>
                    <div class="color-item" style="background-color: green;">Verde</div>
                    <div class="color-item" style="background-color: yellow;">Amarillo</div>
                    <div class="color-item" style="background-color: orange;">Naranja</div>
                    <div class="color-item" style="background-color: purple;">Violeta</div>
                </div>
            </div>

            <div class="info-section">
                <h3>📊 Sistema de Pistas</h3>
                <div class="hints-grid">
                    <div class="hint-item">
                        <span class="hint-icon correct">✓</span>
                        <span><strong>Posición correcta:</strong> Color correcto en posición exacta</span>
                    </div>
                    <div class="hint-item">
                        <span class="hint-icon partial">⚬</span>
                        <span><strong>Color correcto:</strong> Color presente pero mal ubicado</span>
                    </div>
                    <div class="hint-item">
                        <span class="hint-icon wrong">❌</span>
                        <span><strong>Tiempo agotado:</strong> Intento perdido por tiempo</span>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3>🏆 Sistema de Puntuación</h3>
                <p>¡Ahora puedes acumular puntos y competir con otros jugadores!</p>
                <div class="mode-grid">
                    <div class="mode-card">
                        <h4>💎 Cálculo de Puntos</h4>
                        <ul>
                            <li><strong>Base:</strong> 1000 puntos por victoria</li>
                            <li><strong>Precisión:</strong> +500pts máximo (menos intentos)</li>
                            <li><strong>Velocidad:</strong> +300pts máximo (menos tiempo)</li>
                            <li><strong>Perfecto:</strong> +200pts (1er intento, <15s)</li>
                        </ul>
                    </div>
                    <div class="mode-card">
                        <h4>📈 Ranking y Estadísticas</h4>
                        <ul>
                            <li>🏆 <strong>Ranking global</strong> de mejores jugadores</li>
                            <li>📊 <strong>Estadísticas personales</strong> detalladas</li>
                            <li>🥇 <strong>Podio especial</strong> para Top 3</li>
                            <li>📜 <strong>Historial</strong> de últimas 20 partidas</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3>🎯 Cómo Jugar</h3>
                <ol class="game-steps">
                    <li><strong>Crear o unirse</strong> a una sala</li>
                    <li><strong>Seleccionar</strong> 4 colores en el orden deseado (aparecen números 1, 2, 3, 4)</li>
                    <li><strong>Enviar</strong> el intento antes de que se agote el tiempo</li>
                    <li><strong>Interpretar</strong> las pistas para ajustar la estrategia</li>
                    <li><strong>Ganar</strong> adivinando la secuencia exacta</li>
                </ol>
            </div>

            <div class="info-section">
                <h3>✨ Características Destacadas</h3>
                <div class="features-grid">
                    <div class="feature-item">🎨 Selección visual con números de orden</div>
                    <div class="feature-item">📊 Contador prominente de intentos</div>
                    <div class="feature-item">� Sistema de puntuación competitivo</div>
                    <div class="feature-item">📈 Ranking global de jugadores</div>
                    <div class="feature-item">�🎉 Efectos de victoria con confeti</div>
                    <div class="feature-item">💔 Revelación de secuencia en derrota</div>
                    <div class="feature-item">🔊 Sonidos dinámicos</div>
                    <div class="feature-item">💬 Chat en tiempo real</div>
                    <div class="feature-item">📱 Diseño responsivo</div>
                    <div class="feature-item">🌈 Secuencias únicas sin repetición</div>
                    <div class="feature-item">🔄 Sistema de revancha con votación</div>
                    <div class="feature-item">📊 Estadísticas personales detalladas</div>
                </div>
            </div>

            <div class="info-section">
                <h3>💡 Estrategias Recomendadas</h3>
                <ul class="strategy-list">
                    <li><strong>Primer intento:</strong> Usar 4 colores diferentes para obtener información</li>
                    <li><strong>Análisis:</strong> Combinar información de colores y posiciones</li>
                    <li><strong>Eliminación:</strong> Descartar colores que no aparecen en las pistas</li>
                    <li><strong>Tiempo:</strong> Planificar antes de seleccionar en modo solo</li>
                    <li><strong>Puntuación máxima:</strong> Resolver en pocos intentos y rápidamente</li>
                    <li><strong>Ranking:</strong> Usa el botón 🏆 para ver tu progreso y competir</li>
                </ul>
            </div>

            <div class="info-footer">
                <p>🎮 <strong>¡Disfruta jugando Adivina Colores Online!</strong></p>
                <p><small>Desarrollado con Firebase Realtime Database • Agosto 2025</small></p>
                <p><small>Desarrollado por Humberto Ovejero • Agosto 2025</small></p>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Ranking -->
<div id="modalRanking" class="modal-overlay">
    <div class="modal-content modal-ranking">
        <div class="modal-header">
            <h2>🏆 Ranking de Puntuaciones</h2>
            <button class="modal-close" onclick="cerrarModalRanking()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="ranking-tabs">
                <button class="tab-btn active" onclick="mostrarTabRanking('global', this)">🌍 Global</button>
                <button class="tab-btn" onclick="mostrarTabRanking('personal', this)">👤 Personal</button>
            </div>
            
            <div id="ranking-global" class="ranking-tab-content active">
                <div id="ranking-lista" class="ranking-list">
                    <div class="loading">Cargando ranking...</div>
                </div>
            </div>
            
            <div id="ranking-personal" class="ranking-tab-content">
                <div id="estadisticas-personales" class="personal-stats">
                    <div class="loading">Cargando estadísticas...</div>
                </div>
                <div id="historial-personal" class="personal-history">
                    <h3>📈 Historial de Puntuaciones</h3>
                    <div id="historial-lista" class="history-list">
                        <div class="loading">Cargando historial...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Compartir Sala -->
<div id="modalCompartir" class="modal-overlay" style="display: none;" onclick="cerrarModalCompartir()">
    <div class="modal-content modal-compartir" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2>🔗 Compartir Sala</h2>
            <button class="modal-close" onclick="cerrarModalCompartir()">×</button>
        </div>
        <div class="modal-body">
            <div class="compartir-info">
                <h3>¡Invita a un amigo a jugar!</h3>
                <p>Comparte este enlace y tu amigo podrá unirse directamente a la sala:</p>
                
                <div class="link-container">
                    <input type="text" id="linkInvitacion" readonly>
                    <button class="btn-copiar" onclick="copiarLink()">
                        <span class="copiar-icon">📋</span>
                        <span class="copiar-text">Copiar</span>
                    </button>
                </div>
                
                <div class="compartir-opciones">
                    <h4>O comparte directamente en:</h4>
                    <div class="social-buttons">
                        <button class="btn-social whatsapp" onclick="compartirWhatsApp()">
                            <span>💬</span> WhatsApp
                        </button>
                        <button class="btn-social facebook" onclick="compartirFacebook()">
                            <span>📘</span> Facebook
                        </button>
                        <button class="btn-social telegram" onclick="compartirTelegram()">
                            <span>✈️</span> Telegram
                        </button>
                    </div>
                </div>
                
                <div class="compartir-nota">
                    <p><strong>Nota:</strong> Si tu amigo no tiene cuenta, se le pedirá que se registre antes de entrar a la sala.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module" src="juego.js"></script>

</body>
</html>